-- HIZLI DESTEK SCRİPTİ (Blade Ball için)
-- Bu script, ana scriptle birlikte çalışır, topu daha erken algılayıp vurur.

local player = game.Players.LocalPlayer
local runService = game:GetService("RunService")
local virtualInput = game:GetService("VirtualInputManager")

-- Algılama eşiği (mesafe/hız oranı). Düşürürsen daha erken vurur.
local TETIKLEME_ORANI = 0.9 -- 0.9 = top daha uzaktayken vur

-- Son vuruş zamanı (çok sık vurmayı engellemek için)
local lastParryTime = 0
local PARRY_COOLDOWN = 0.2

-- Top klasörünü bul (birden çok isim dene)
local function findBallsFolder()
    local possibleNames = {"Balls", "Projectiles", "Throwables", "BallsFolder"}
    for _, name in ipairs(possibleNames) do
        local folder = workspace:FindFirstChild(name)
        if folder then return folder end
    end
    return nil
end

-- Topun hızını bul (farklı kaynakları dene)
local function getBallSpeed(ball)
    -- 1. Direkt Velocity
    local v = ball.Velocity
    if v and v.Magnitude > 0.1 then return v.Magnitude end
    
    -- 2. AssemblyLinearVelocity
    local success, av = pcall(function() return ball.AssemblyLinearVelocity end)
    if success and av and av.Magnitude > 0.1 then return av.Magnitude end
    
    -- 3. "zoomies" adlı çocuk (BodyVelocity veya Vector3Value)
    local zoomies = ball:FindFirstChild("zoomies")
    if zoomies then
        if zoomies:IsA("BodyVelocity") then
            return zoomies.Velocity.Magnitude
        elseif zoomies:IsA("Vector3Value") then
            return zoomies.Value.Magnitude
        end
    end
    
    -- 4. Herhangi bir BodyVelocity çocuğu
    for _, child in ipairs(ball:GetChildren()) do
        if child:IsA("BodyVelocity") then
            return child.Velocity.Magnitude
        end
    end
    
    return 0 -- hız bulunamadı
end

-- Ana döngü: her frame'de kontrol et
runService.PreSimulation:Connect(function()
    local now = tick()
    if now - lastParryTime < PARRY_COOLDOWN then return end
    
    local character = player.Character
    if not character then return end
    local hrp = character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    
    local ballsFolder = findBallsFolder()
    if not ballsFolder then return end
    
    for _, ball in ipairs(ballsFolder:GetChildren()) do
        -- Top geçerli bir part mı?
        if not ball:IsA("BasePart") then continue end
        
        -- "realBall" attribute'ü var mı? (ana scriptteki kontrol)
        local isReal = ball:GetAttribute("realBall")
        if isReal == nil then
            -- Eğer attribute yoksa, belki başka bir top tipidir, yine de dene
        end
        
        -- Hızını al
        local speed = getBallSpeed(ball)
        if speed < 1 then continue end -- çok yavaş veya hız yok
        
        -- Hedef oyuncu
        local target = ball:GetAttribute("target")
        if target and target ~= player.Name then continue end -- bize gelmiyorsa atla
        
        local distance = (hrp.Position - ball.Position).Magnitude
        local timeToHit = distance / speed
        
        if timeToHit <= TETIKLEME_ORANI then
            -- VUR!
            virtualInput:SendMouseButtonEvent(0, 0, 0, true, game, 0)
            task.wait(0.03)
            virtualInput:SendMouseButtonEvent(0, 0, 0, false, game, 0)
            
            lastParryTime = now
            break -- bir topa vurduk, diğerlerine gerek yok
        end
    end
end)

print("✅ Destek scripti aktif! Tetikleme oranı:", TETIKLEME_ORANI)
