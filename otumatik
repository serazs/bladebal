-- ULTIMATE BLADE BALL AUTO PARRY v3
-- Profesyonel versiyon - En hÄ±zlÄ± algÄ±lama + GÃ¶rsel efektler

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local CoreGui = game:GetService("CoreGui")

local player = Players.LocalPlayer
local camera = workspace.CurrentCamera

-- ===== AYARLAR (KENDÄ°NE GÃ–RE DÃœZENLE) =====
local settings = {
    AutoParry = true,           -- Otomatik vuruÅŸ aÃ§Ä±k/kapalÄ±
    ParryDistance = 25,          -- VuruÅŸ mesafesi (ne kadar uzaktan vursun)
    ParryTime = 0.55,            -- VuruÅŸ zamanlamasÄ± (0.3-0.7 arasÄ±, dÃ¼ÅŸÃ¼k=erken)
    PredictionStrength = 1.2,     -- Tahmin gÃ¼cÃ¼ (yÃ¼ksek=erken vurur)
    ShowESP = true,              -- GÃ¶rsel Ã§izgileri gÃ¶ster
    ESPColor = Color3.fromRGB(255, 50, 50),  -- KÄ±rmÄ±zÄ± Ã§izgi
    ShowBallPath = true,         -- Top yolunu gÃ¶ster
    AutoEnableOnSpawn = true,    -- Her doÄŸuÅŸta otomatik aÃ§
    FasterThanHuman = true,       -- Ä°nsanÃ¼stÃ¼ hÄ±z (hep true)
    UseVirtualClick = true,       -- Sanal tÄ±klama kullan
    Keybind = Enum.KeyCode.F,     -- AÃ§/kapa tuÅŸu
    VisualizerTransparency = 0.3, -- GÃ¶rsel efekt saydamlÄ±ÄŸÄ±
    PredictionColor = Color3.fromRGB(0, 255, 255)  -- Mavi tahmin Ã§izgisi
}

-- ===== DEÄžÄ°ÅžKENLER =====
local ballsFolder = workspace:FindFirstChild("Balls") or workspace:FindFirstChild("Projectiles") or workspace:FindFirstChild("Throwables") or workspace:FindFirstChild("BallFolder")
local lastParryTime = 0
local lastBallPosition = nil
local lastBallVelocity = nil
local predictionLines = {}
local espEnabled = settings.ShowESP

-- ===== GÃ–RSEL ARAYÃœZ (GUI) =====
local function createGUI()
    -- Ana GUI
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "BladeBallPro"
    screenGui.Parent = CoreGui
    screenGui.ResetOnSpawn = false
    
    -- Ana Panel
    local mainFrame = Instance.new("Frame")
    mainFrame.Size = UDim2.new(0, 250, 0, 300)
    mainFrame.Position = UDim2.new(0.02, 0, 0.3, 0)
    mainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
    mainFrame.BackgroundTransparency = 0.1
    mainFrame.BorderSizePixel = 0
    mainFrame.Parent = screenGui
    mainFrame.Active = true
    mainFrame.Draggable = true
    
    -- KenarlÄ±k (RGB efektli)
    local stroke = Instance.new("UIStroke")
    stroke.Thickness = 2
    stroke.Color = Color3.fromRGB(0, 255, 255)
    stroke.Parent = mainFrame
    
    -- KÃ¶ÅŸeler
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 10)
    corner.Parent = mainFrame
    
    -- BaÅŸlÄ±k
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 0, 40)
    title.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
    title.Text = "âš¡ BLADE BALL PRO"
    title.TextColor3 = Color3.new(1, 1, 1)
    title.Font = Enum.Font.GothamBold
    title.TextSize = 18
    title.Parent = mainFrame
    
    local titleCorner = Instance.new("UICorner")
    titleCorner.CornerRadius = UDim.new(0, 10)
    titleCorner.Parent = title
    
    -- AÃ§/Kapa butonu
    local toggleBtn = Instance.new("TextButton")
    toggleBtn.Size = UDim2.new(0.8, 0, 0, 40)
    toggleBtn.Position = UDim2.new(0.1, 0, 0.15, 0)
    toggleBtn.BackgroundColor3 = settings.AutoParry and Color3.fromRGB(0, 200, 100) or Color3.fromRGB(200, 0, 0)
    toggleBtn.Text = settings.AutoParry and "âœ… AKTÄ°F" or "âŒ DEVRE DIÅžI"
    toggleBtn.TextColor3 = Color3.new(1, 1, 1)
    toggleBtn.Font = Enum.Font.GothamBold
    toggleBtn.TextSize = 16
    toggleBtn.Parent = mainFrame
    
    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0, 8)
    btnCorner.Parent = toggleBtn
    
    -- Mesafe ayarÄ±
    local distLabel = Instance.new("TextLabel")
    distLabel.Size = UDim2.new(0.8, 0, 0, 20)
    distLabel.Position = UDim2.new(0.1, 0, 0.3, 0)
    distLabel.BackgroundTransparency = 1
    distLabel.Text = "Mesafe: " .. settings.ParryDistance
    distLabel.TextColor3 = Color3.new(1, 1, 1)
    distLabel.Font = Enum.Font.Gotham
    distLabel.TextSize = 14
    distLabel.Parent = mainFrame
    
    -- Mesafe slider (basit butonlarla)
    local distUp = Instance.new("TextButton")
    distUp.Size = UDim2.new(0.2, 0, 0, 25)
    distUp.Position = UDim2.new(0.1, 0, 0.35, 0)
    distUp.BackgroundColor3 = Color3.fromRGB(50, 50, 70)
    distUp.Text = "+"
    distUp.TextColor3 = Color3.new(1, 1, 1)
    distUp.Font = Enum.Font.GothamBold
    distUp.TextSize = 18
    distUp.Parent = mainFrame
    
    local distDown = Instance.new("TextButton")
    distDown.Size = UDim2.new(0.2, 0, 0, 25)
    distDown.Position = UDim2.new(0.7, 0, 0.35, 0)
    distDown.BackgroundColor3 = Color3.fromRGB(50, 50, 70)
    distDown.Text = "-"
    distDown.TextColor3 = Color3.new(1, 1, 1)
    distDown.Font = Enum.Font.GothamBold
    distDown.TextSize = 18
    distDown.Parent = mainFrame
    
    -- Zamanlama ayarÄ±
    local timeLabel = Instance.new("TextLabel")
    timeLabel.Size = UDim2.new(0.8, 0, 0, 20)
    timeLabel.Position = UDim2.new(0.1, 0, 0.45, 0)
    timeLabel.BackgroundTransparency = 1
    timeLabel.Text = "Zamanlama: " .. settings.ParryTime
    timeLabel.TextColor3 = Color3.new(1, 1, 1)
    timeLabel.Font = Enum.Font.Gotham
    timeLabel.TextSize = 14
    timeLabel.Parent = mainFrame
    
    local timeUp = Instance.new("TextButton")
    timeUp.Size = UDim2.new(0.2, 0, 0, 25)
    timeUp.Position = UDim2.new(0.1, 0, 0.5, 0)
    timeUp.BackgroundColor3 = Color3.fromRGB(50, 50, 70)
    timeUp.Text = "+"
    timeUp.TextColor3 = Color3.new(1, 1, 1)
    timeUp.Font = Enum.Font.GothamBold
    timeUp.TextSize = 18
    timeUp.Parent = mainFrame
    
    local timeDown = Instance.new("TextButton")
    timeDown.Size = UDim2.new(0.2, 0, 0, 25)
    timeDown.Position = UDim2.new(0.7, 0, 0.5, 0)
    timeDown.BackgroundColor3 = Color3.fromRGB(50, 50, 70)
    timeDown.Text = "-"
    timeDown.TextColor3 = Color3.new(1, 1, 1)
    timeDown.Font = Enum.Font.GothamBold
    timeDown.TextSize = 18
    timeDown.Parent = mainFrame
    
    -- ESP aÃ§/kapa
    local espToggle = Instance.new("TextButton")
    espToggle.Size = UDim2.new(0.8, 0, 0, 30)
    espToggle.Position = UDim2.new(0.1, 0, 0.6, 0)
    espToggle.BackgroundColor3 = settings.ShowESP and Color3.fromRGB(0, 150, 200) or Color3.fromRGB(100, 100, 100)
    espToggle.Text = settings.ShowESP and "ðŸ‘ï¸ ESP: AÃ‡IK" or "ðŸ‘ï¸ ESP: KAPALI"
    espToggle.TextColor3 = Color3.new(1, 1, 1)
    espToggle.Font = Enum.Font.GothamBold
    espToggle.TextSize = 14
    espToggle.Parent = mainFrame
    
    local espCorner = Instance.new("UICorner")
    espCorner.CornerRadius = UDim.new(0, 8)
    espCorner.Parent = espToggle
    
    -- Alt bilgi
    local credit = Instance.new("TextLabel")
    credit.Size = UDim2.new(1, 0, 0, 30)
    credit.Position = UDim2.new(0, 0, 1, -30)
    credit.BackgroundTransparency = 1
    credit.Text = "âš¡ 31 AKTÄ°F âš¡"
    credit.TextColor3 = Color3.fromRGB(255, 100, 100)
    credit.Font = Enum.Font.GothamBold
    credit.TextSize = 16
    credit.Parent = mainFrame
    
    -- ===== BUTON FONKSÄ°YONLARI =====
    toggleBtn.MouseButton1Click:Connect(function()
        settings.AutoParry = not settings.AutoParry
        toggleBtn.BackgroundColor3 = settings.AutoParry and Color3.fromRGB(0, 200, 100) or Color3.fromRGB(200, 0, 0)
        toggleBtn.Text = settings.AutoParry and "âœ… AKTÄ°F" or "âŒ DEVRE DIÅžI"
    end)
    
    distUp.MouseButton1Click:Connect(function()
        settings.ParryDistance = math.min(50, settings.ParryDistance + 2)
        distLabel.Text = "Mesafe: " .. settings.ParryDistance
    end)
    
    distDown.MouseButton1Click:Connect(function()
        settings.ParryDistance = math.max(10, settings.ParryDistance - 2)
        distLabel.Text = "Mesafe: " .. settings.ParryDistance
    end)
    
    timeUp.MouseButton1Click:Connect(function()
        settings.ParryTime = math.min(0.9, settings.ParryTime + 0.05)
        timeLabel.Text = "Zamanlama: " .. string.format("%.2f", settings.ParryTime)
    end)
    
    timeDown.MouseButton1Click:Connect(function()
        settings.ParryTime = math.max(0.2, settings.ParryTime - 0.05)
        timeLabel.Text = "Zamanlama: " .. string.format("%.2f", settings.ParryTime)
    end)
    
    espToggle.MouseButton1Click:Connect(function()
        settings.ShowESP = not settings.ShowESP
        espToggle.BackgroundColor3 = settings.ShowESP and Color3.fromRGB(0, 150, 200) or Color3.fromRGB(100, 100, 100)
        espToggle.Text = settings.ShowESP and "ðŸ‘ï¸ ESP: AÃ‡IK" or "ðŸ‘ï¸ ESP: KAPALI"
    end)
    
    return screenGui
end

-- GUI'yi oluÅŸtur
local gui = createGUI()

-- ===== TOP HIZINI BUL (GELÄ°ÅžMÄ°Åž) =====
local function getBallSpeed(ball)
    -- 1. Direkt Velocity
    if ball.Velocity and ball.Velocity.Magnitude > 0.1 then
        return ball.Velocity.Magnitude, ball.Velocity
    end
    
    -- 2. AssemblyLinearVelocity
    if ball.AssemblyLinearVelocity and ball.AssemblyLinearVelocity.Magnitude > 0.1 then
        return ball.AssemblyLinearVelocity.Magnitude, ball.AssemblyLinearVelocity
    end
    
    -- 3. "zoomies" (Blade Ball Ã¶zel)
    local zoomies = ball:FindFirstChild("zoomies")
    if zoomies then
        if zoomies:IsA("BodyVelocity") then
            return zoomies.Velocity.Magnitude, zoomies.Velocity
        elseif zoomies:IsA("Vector3Value") then
            return zoomies.Value.Magnitude, zoomies.Value
        end
    end
    
    -- 4. DiÄŸer BodyVelocity'ler
    for _, child in ipairs(ball:GetChildren()) do
        if child:IsA("BodyVelocity") then
            return child.Velocity.Magnitude, child.Velocity
        end
    end
    
    return 0, Vector3.new(0,0,0)
end

-- ===== EN YAKIN TEHLÄ°KELÄ° TOPU BUL =====
local function findDangerousBall()
    local character = player.Character
    if not character then return nil end
    
    local hrp = character:FindFirstChild("HumanoidRootPart")
    if not hrp then return nil end
    
    if not ballsFolder then
        ballsFolder = workspace:FindFirstChild("Balls") or workspace:FindFirstChild("Projectiles") 
        if not ballsFolder then return nil end
    end
    
    local closestBall = nil
    local closestTime = math.huge
    local closestDistance = math.huge
    
    for _, ball in ipairs(ballsFolder:GetChildren()) do
        if ball:IsA("BasePart") then
            -- Hedef kontrolÃ¼
            local target = ball:GetAttribute("target")
            if target and target ~= player.Name then
                continue  -- Bu top baÅŸkasÄ±na gidiyor
            end
            
            local speed, velocity = getBallSpeed(ball)
            if speed < 5 then continue end  -- Ã‡ok yavaÅŸ toplarÄ± atla
            
            local ballPos = ball.Position
            local toPlayer = hrp.Position - ballPos
            local distance = toPlayer.Magnitude
            
            -- Top oyuncuya doÄŸru geliyor mu?
            local direction = velocity.unit
            local toPlayerDir = toPlayer.unit
            local dotProduct = toPlayerDir:Dot(direction)
            
            if dotProduct > 0.5 then  -- YaklaÅŸÄ±k aynÄ± yÃ¶nde
                -- Ã‡arpma sÃ¼resini hesapla
                local timeToHit = distance / speed
                
                if timeToHit < closestTime and distance < settings.ParryDistance * 2 then
                    closestTime = timeToHit
                    closestDistance = distance
                    closestBall = ball
                    lastBallVelocity = velocity
                    lastBallPosition = ballPos
                end
            end
        end
    end
    
    return closestBall, closestTime, closestDistance
end

-- ===== GÃ–RSEL Ã‡Ä°ZGÄ°LER (ESP) =====
local function updateESP()
    if not settings.ShowESP then
        for _, line in ipairs(predictionLines) do
            if line then line:Destroy() end
        end
        predictionLines = {}
        return
    end
    
    local character = player.Character
    if not character then return end
    
    local hrp = character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    
    local ball, timeToHit, distance = findDangerousBall()
    
    -- Eski Ã§izgileri temizle
    for _, line in ipairs(predictionLines) do
        if line then line:Destroy() end
    end
    predictionLines = {}
    
    if ball and timeToHit then
        -- Top ile oyuncu arasÄ±nda Ã§izgi
        local line = Instance.new("Part")
        line.Name = "BallLine"
        line.Size = Vector3.new(0.2, 0.2, distance)
        line.CFrame = CFrame.lookAt(ball.Position, hrp.Position) * CFrame.new(0, 0, -distance/2)
        line.Anchored = true
        line.CanCollide = false
        line.Material = Enum.Material.Neon
        line.BrickColor = BrickColor.new("Really red")
        line.Transparency = settings.VisualizerTransparency
        line.Parent = workspace
        table.insert(predictionLines, line)
        
        -- Tahmin noktasÄ± (topun gelecekteki konumu)
        if lastBallVelocity and lastBallVelocity.Magnitude > 0 then
            local futurePos = ball.Position + lastBallVelocity * timeToHit * settings.PredictionStrength
            local predictionPoint = Instance.new("Part")
            predictionPoint.Name = "PredictionPoint"
            predictionPoint.Size = Vector3.new(1, 1, 1)
            predictionPoint.Shape = Enum.PartType.Ball
            predictionPoint.Position = futurePos
            predictionPoint.Anchored = true
            predictionPoint.CanCollide = false
            predictionPoint.BrickColor = BrickColor.new("Cyan")
            predictionPoint.Material = Enum.Material.Neon
            predictionPoint.Transparency = 0.2
            predictionPoint.Parent = workspace
            table.insert(predictionLines, predictionPoint)
            
            -- Tahmin Ã§izgisi
            local predictionLine = Instance.new("Part")
            predictionLine.Name = "PredictionLine"
            predictionLine.Size = Vector3.new(0.1, 0.1, (futurePos - ball.Position).Magnitude)
            predictionLine.CFrame = CFrame.lookAt(ball.Position, futurePos) * CFrame.new(0, 0, -(futurePos - ball.Position).Magnitude/2)
            predictionLine.Anchored = true
            predictionLine.CanCollide = false
            predictionLine.BrickColor = BrickColor.new("Bright blue")
            predictionLine.Material = Enum.Material.Neon
            predictionLine.Transparency = 0.4
            predictionLine.Parent = workspace
            table.insert(predictionLines, predictionLine)
        end
    end
end

-- ===== VURUÅž FONKSÄ°YONU (EN KRÄ°TÄ°K KISIM) =====
local function performParry()
    if not settings.AutoParry then return end
    
    local now = tick()
    if now - lastParryTime < 0.15 then return end  -- Cooldown
    
    local ball, timeToHit, distance = findDangerousBall()
    if not ball or not timeToHit then return end
    
    -- Zamanlama kontrolÃ¼ (oyuncuya Ã§arpmasÄ±na ne kadar kaldÄ±)
    local timeThreshold = settings.ParryTime
    
    -- HÄ±zlÄ± modda daha erken vur
    if settings.FasterThanHuman then
        timeThreshold = timeThreshold * 1.3
    end
    
    if timeToHit <= timeThreshold and distance <= settings.ParryDistance then
        -- VURUÅž!
        if settings.UseVirtualClick then
            -- Sanal tÄ±klama (en hÄ±zlÄ± yÃ¶ntem)
            VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 0)
            task.wait(0.03)
            VirtualInputManager:SendMouseButtonEvent(0, 0, 0, false, game, 0)
        else
            -- Alternatif vuruÅŸ yÃ¶ntemi
            local remote = game:GetService("ReplicatedStorage"):FindFirstChild("Parry") 
                    or game:GetService("ReplicatedStorage"):FindFirstChild("Swing")
                    or game:GetService("ReplicatedStorage"):FindFirstChild("Block")
            if remote then
                remote:FireServer(ball)
            end
        end
        
        lastParryTime = now
        
        -- GÃ¶rsel geri bildirim (ekranda parÄ±ltÄ±)
        local flash = Instance.new("Frame")
        flash.Size = UDim2.new(1, 0, 1, 0)
        flash.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        flash.BackgroundTransparency = 0.7
        flash.Parent = gui
        flash.ZIndex = 10
        
        task.delay(0.1, function()
            flash:Destroy()
        end)
    end
end

-- ===== ANA DÃ–NGÃœ (Ã‡OK HIZLI) =====
RunService.RenderStepped:Connect(function()
    performParry()
    updateESP()
end)

-- ===== KARAKTER YENÄ°DEN DOÄžUNCA =====
player.CharacterAdded:Connect(function()
    task.wait(0.5)
    if settings.AutoEnableOnSpawn then
        settings.AutoParry = true
    end
end)

-- ===== TUÅžLA AÃ‡/KAPA =====
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed and input.KeyCode == settings.Keybind then
        settings.AutoParry = not settings.AutoParry
        print("âš¡ Auto Parry:", settings.AutoParry and "AKTÄ°F" or "DEVRE DIÅžI")
    end
end)

-- ===== BAÅžLANGIÃ‡ BÄ°LDÄ°RÄ°MÄ° =====
local notification = Instance.new("TextLabel")
notification.Size = UDim2.new(0, 300, 0, 70)
notification.Position = UDim2.new(0.5, -150, 0.8, 0)
notification.BackgroundColor3 = Color3.fromRGB(0, 100, 200)
notification.BackgroundTransparency = 0.2
notification.Text = "âš¡ 31 AKTÄ°F âš¡\nULTIMATE AUTO PARRY"
notification.TextColor3 = Color3.new(1, 1, 1)
notification.Font = Enum.Font.GothamBold
notification.TextSize = 24
notification.TextWrapped = true
notification.Parent = CoreGui

local notifCorner = Instance.new("UICorner")
notifCorner.CornerRadius = UDim.new(0, 20)
notifCorner.Parent = notification

task.delay(4, function()
    notification:Destroy()
end)

print("âœ… ULTIMATE BLADE BALL SCRIPT YÃœKLENDÄ°!")
print("ðŸŽ¯ F tuÅŸu ile aÃ§/kapa | Mesafe: " .. settings.ParryDistance .. " | Zamanlama: " .. settings.ParryTime)
